#!/usr/bin/stap
# Decription: monitor the memory allocated and released
# Usage: stap allocate.stp <pid> <sample_ratio_seconds>
# the <pid> is optional,then it will show all processes' info.
global process, uprocess;

probe kernel.function("sys_mmap2") {
  process[execname(), ppid(), pid(), cpu()] += $len;
}	

probe kernel.function("sys_munmap") {
  uprocess[execname(), ppid(), pid(), cpu()] += $len;  
}

probe begin {
  printf("the args count: %d", $#);	
//  if (($# != 1) && ()) {
    printf("Usage: stap allocate.stp <pid> <sample_ratio_seconds>\n");
    exit();
//  }	  
  printf("%20s %5s")
}
