#!/usr/bin/stap
global cnt;
probe scheduler.cpu_on {
  printf("Pid: %d, process: %s, CPU: %d\n", pid(), execname(), cpu());
  cnt<<<1;
} 
probe timer.s(1) { 
  printf("%d\n", @count(cnt)); 
  delete cnt;
}

probe kernel.function("*@kernel/sched.c:686") {
  printf("Active process: %d\n", $array->nr_active)
  printf("Current pid %d in ", $p->pid)
  if (!$p->state)
    printf("running state\n")
  else if($p->state > 0)
    printf("stopped state\n")
  else // -1
    printf("unrunable  state\n")	  
}
